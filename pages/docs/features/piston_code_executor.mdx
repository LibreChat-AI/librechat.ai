---
title: Piston Code Executor
description: Self-hostable code execution for 150+ programming languages without API subscription requirements
---

# Piston Code Executor

## Introduction

Piston Code Executor is a self-hostable alternative to LibreChat Code Interpreter API, providing code execution capabilities for 150+ programming languages. It's designed for users who need data sovereignty, GDPR compliance, or air-gapped deployments.

**Key differences from Code Interpreter API:**
- Self-hostable (no external API required)
- Stateless execution environment
- Full control over packages and dependencies
- Optional quick start with public API for testing

## Quick Start

### Option 1: Public API (Testing Only)

For quick testing, add one line to your `.env`:

```bash
CODE_EXECUTOR=piston
```

Restart LibreChat and create an agent with Code Execution enabled.

**Note**: The public API has rate limits and is not suitable for production use.

### Option 2: Self-Hosted (Production)

1. Uncomment the Piston service in `docker-compose.override.yml.example`:

```yaml
piston:
  image: ghcr.io/engineer-man/piston:latest
  container_name: piston
  privileged: true
  restart: always
  ports:
    - "2000:2000"
```

2. Add to your `.env`:

```bash
CODE_EXECUTOR=piston
PISTON_URL=http://piston:2000/api/v2/piston
```

3. Start your services:

```bash
docker compose up -d
```

## Configuration

Add these variables to your `.env` file:

| Variable | Description | Default |
|----------|-------------|---------|
| `CODE_EXECUTOR` | Set to `piston` to enable | `librechat` |
| `PISTON_URL` | Piston API endpoint | Public API |
| `PISTON_API_KEY` | Optional authentication | None |
| `PISTON_RUN_TIMEOUT` | Execution timeout (ms) | Server default |
| `PISTON_RUN_MEMORY_LIMIT` | Memory limit (bytes) | Server default |
| `PISTON_OUTPUT_MAX_SIZE` | Max output size (bytes) | Server default |
| `PISTON_COMPILE_TIMEOUT` | Compile timeout (ms) | Server default |
| `PISTON_COMPILE_MEMORY_LIMIT` | Compile memory (bytes) | Server default |

See `.env.example` for all options and recommended values.

## Features

### Multi-Turn File Persistence

Files uploaded in a conversation remain accessible across all turns. Agents can reference and process files from any point in the conversation, even though Piston itself is stateless.

**How it works:**
- Files are stored in LibreChat's database with `context: message_attachment`
- The Piston tool retrieves all conversation files for each execution
- Generated files are saved back to the conversation
- All files remain accessible throughout the conversation

### Generated File Downloads

Code can generate files (charts, reports, documents, etc.) that appear as downloadable attachments. The agent automatically embeds special markers in the code to capture output files from stdout.

### Custom Package Installation (Self-Hosted)

When self-hosting, you can install any packages or system dependencies:
- **Libraries**: matplotlib, pandas, numpy, scikit-learn, etc.
- **System tools**: ffmpeg, .NET Core, ImageMagick, etc.
- **Custom runtimes**: Configure specific language versions

## Limitations

### Stateless Execution
Unlike Jupyter notebooks, each execution starts fresh with no persistent state. Files and variables don't carry over between runs automatically.

### No Internet Access
Piston typically runs without network access by design (security isolation). Cannot fetch external resources during execution.

### File Output Workaround
Uses stdout markers instead of native file handling. While this works reliably, it's not as elegant as the Librechat Code Interpreter API's native file support.

## Switching Between Executors

To switch back to LibreChat Code Interpreter API:

```bash
CODE_EXECUTOR=librechat
# or simply remove/comment out the CODE_EXECUTOR line
```

Both executors can coexist - just change the environment variable and restart.

## Security Considerations

- File uploads are available to the entire conversation (similar to OpenAI's image tool)
- Review generated code when using untrusted agents
- Configure appropriate resource limits when self-hosting
- Consider network isolation for Piston container in production
- Piston uses `isolate` for sandboxing - review security implications for your use case

