# AWS Bedrock

Head to the [AWS docs](https://docs.aws.amazon.com/bedrock/latest/userguide/getting-started.html) to sign up for AWS and setup your credentials.

Youâ€™ll also need to turn on model access for your account, which you can do by [following these instructions](https://docs.aws.amazon.com/bedrock/latest/userguide/model-access.html).

## Authentication

LibreChat supports three methods for AWS Bedrock authentication, listed in order of recommendation:

### Option 1: AWS Profile

Using AWS profiles to handle credentials.

1. **Configure your AWS profile** in `~/.aws/credentials` or `~/.aws/config`:

```bash filename="~/.aws/config"
[profile your-profile-name]
region = us-west-2
```

```bash filename="~/.aws/credentials"
[your-profile-name]
aws_access_key_id = YOUR_ACCESS_KEY
aws_secret_access_key = YOUR_SECRET_KEY
aws_session_token = YOUR_SESSION_TOKEN
```

2. **Set environment variables** in your `.env` file:

```bash filename=".env"
BEDROCK_AWS_DEFAULT_REGION=us-west-2
BEDROCK_AWS_PROFILE=your-profile-name
```

**Optional: Enable Auto-Refresh**

For automatic credential refresh using external commands (e.g., company-specific credential tools), configure `credential_process` in `~/.aws/config`:

```bash filename="~/.aws/config"
[profile your-profile-name]
region = us-west-2
credential_process = your-command-to-fetch-credentials --format json
```

The command must output credentials in this JSON format:
```json
{
  "Version": 1,
  "AccessKeyId": "...",
  "SecretAccessKey": "...",
  "SessionToken": "...",
  "Expiration": "2025-10-31T23:59:59Z"
}
```

**Resources:**
- [AWS CLI Configuration Files](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html)
- [Sourcing Credentials with External Process](https://docs.aws.amazon.com/cli/v1/userguide/cli-configure-sourcing-external.html)

### Option 2: AWS Credential Provider Chain (Recommended for Production)

When no explicit credentials or profile are provided, the AWS SDK uses its default credential provider chain. This is ideal for production environments using IAM roles or EC2/ECS metadata.

Set only the required region in your `.env` file:

```bash filename=".env"
BEDROCK_AWS_DEFAULT_REGION=us-east-1
```

The credential provider will automatically find credentials from these sources (in order of precedence):

1. Environment variables (`AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, `AWS_SESSION_TOKEN`)
2. SSO credentials from token cache
3. Web identity token credentials
4. Shared credentials and config ini files (`~/.aws/credentials`, `~/.aws/config`)
5. EC2/ECS Instance Metadata Service

**Note:** The provider stops searching once credentials are found. For example, if environment variables are set, AWS credential files won't be read.

### Option 3: Static Environment Variables (Not Recommended for Temporary Credentials)

For simple setups or long-lived credentials, you can set credentials directly in your `.env` file:

```bash filename=".env"
BEDROCK_AWS_DEFAULT_REGION=us-east-1
BEDROCK_AWS_ACCESS_KEY_ID=your_access_key_id
BEDROCK_AWS_SECRET_ACCESS_KEY=your_secret_access_key
# Optional: Only needed for temporary credentials
BEDROCK_AWS_SESSION_TOKEN=your_session_token
```

**Warning:** This method requires manual updates when credentials expire and is not suitable for temporary credentials that rotate frequently.

## Configuring models

- You can optionally specify which models you want to make available with `BEDROCK_AWS_MODELS`:

```bash filename=".env"
BEDROCK_AWS_MODELS=anthropic.claude-3-5-sonnet-20240620-v1:0,meta.llama3-1-8b-instruct-v1:0
```

Note: If omitted, all known, supported model IDs will be included automatically.

- See all Bedrock model IDs here:
    - **[https://docs.aws.amazon.com/bedrock/latest/userguide/model-ids.html#model-ids-arns](https://docs.aws.amazon.com/bedrock/latest/userguide/model-ids.html#model-ids-arns)**

## Additional Configuration

You can further configure the Bedrock endpoint in your [`librechat.yaml`](/docs/configuration/librechat_yaml/) file:

```yaml
endpoints:
  bedrock:
    availableRegions:
      - "us-east-1"
      - "us-west-2"
    streamRate: 35
    titleModel: 'anthropic.claude-3-haiku-20240307-v1:0'
```

- `streamRate`: (Optional) Set the rate of processing each new token in milliseconds.
    - This can help stabilize processing of concurrent requests and provide smoother frontend stream rendering.

- `titleModel`: (Optional) Specify the model to use for generating conversation titles.
    - Recommended: `anthropic.claude-3-haiku-20240307-v1:0`.
    - Omit or set as `current_model` to use the same model as the chat.

- `availableRegions`: (Optional) Specify the AWS regions you want to make available.
    - If provided, users will see a dropdown to select the region. If not selected, the default region is used.
    - ![image](https://github.com/user-attachments/assets/6f3c5e82-9c6b-4643-8487-07db1061ba49)

## Notes

- The following models are not supported due to lack of streaming capability:
  - ai21.j2-mid-v1

- The following models are not supported due to lack of conversation history support:
  - ai21.j2-ultra-v1
  - cohere.command-text-v14
  - cohere.command-light-text-v14

- AWS Bedrock endpoint supports all [Shared Endpoint Settings](/docs/configuration/librechat_yaml/object_structure/shared_endpoint_settings) via the `librechat.yaml` configuration file, including `streamRate`, `titleModel`, `titleMethod`, `titlePrompt`, `titlePromptTemplate`, and `titleEndpoint`